<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Base Distributed Module &#8212; DistDL 0.5.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/pydoctheme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    
    <script src="../../_static/sidebar.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Normalization Layers" href="norm.html" />
    <link rel="prev" title="Loss Functions" href="loss.html" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="shortcut icon" type="image/png" href="../../_static/favicon.png" />
    <meta name="viewport" content="width=device-width,initial-scale=0.8">
    
    

  </head><body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="responsive-menu"><a href="#sidebar-anchor" title="Navigation">&#9776;</a></li>
        <li><a href="../../index.html">DistDL-0.5.0</a> &#187;</li>
          <li><a href="../index.html" >Code Reference</a> &#187;</li>
          <li><a href="../nn.html" accesskey="U">distdl.nn</a> &#187;</li> 
      </ul>
    </div>
    
        <div class="badge">
            <a href="https://github.com/microsoft/distdl/">Fork me on GitHub</a>
            <img src="../../_static/right-red@2x.png">
        </div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="base-distributed-module">
<h1>Base Distributed Module<a class="headerlink" href="#base-distributed-module" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id1">Overview</a></p></li>
<li><p><a class="reference internal" href="#motivation" id="id2">Motivation</a></p></li>
<li><p><a class="reference internal" href="#implementation" id="id3">Implementation</a></p></li>
<li><p><a class="reference internal" href="#api" id="id4">API</a></p></li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference external" href="https://docs.python.org/3/glossary.html#term-module" title="(in Python v3.11)"><code class="xref any docutils literal notranslate"><span class="pre">Module</span></code></a> container is an extension of the Torch <span class="xref std std-ref">torch.nn.Module</span> container which defines the interface that is
required to allow a DistDL distributed layer to perform any necessary setup or
teardown operations.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This container inherits from PyTorch and should be used as the base-class
for any DistDL distributed layer.</p>
</div>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Motivation</a><a class="headerlink" href="#motivation" title="Permalink to this heading">¶</a></h2>
<p>DistDL aims to preserve PyTorch-like interfaces, so that information about the
input tensor, other than the partition functions, is not required at the
instantiation of the layer.  Consequently, some layer variables, such as
intermediate communication buffers, for example in the
<code class="xref any docutils literal notranslate"><span class="pre">distdl.nn.HaloExchange</span></code> layer or the
<code class="xref any docutils literal notranslate"><span class="pre">distdl.nn.Repartition</span></code> layer, can only be determined when the
layer is evaluated.</p>
<p>The interfaces defined here allow those properties to be setup (and torn down)
safely when the layer is evaluated.</p>
</section>
<section id="implementation">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h2>
<p>However, there is significant cost to the setup phase.  To avoid this cost,
the setup phase is only called when there is a change to the structure of the
<em>global</em> input tensor.  We currently define the structure to be the shape and
<code class="docutils literal notranslate"><span class="pre">requires_grad</span></code> status.  In the future, the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> will also be part of
this determination.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Each worker will only have knowledge of their local input tensors.  It is
not possible to determine if the global tensor has changed without a global
communication. Practically, this means that the first dimension of the
tensor, usually the batch dimension, which should be the same across all
workers in a partition, is the primary indicator of change.</p>
<p>It is possible that the feature shape can be changed globally without
changing the local feature shape, so care must be taken.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is largely designed to allow the batch to change, however, for
performance purposes, frequent changes to the batch size and other tensor
structure should be avoided.</p>
</div>
<p>The check if the input tensor has changed is defined per-layer, allowing for
implementation specific behavior.</p>
<p>The <code class="xref any docutils literal notranslate"><span class="pre">Module._distdl_forward_pre_hook</span></code> function is registered as a Torch
pre-forward hook.  This hook checks if the layer needs to be setup, either
from scratch or as a reset, and then calls the setup function.</p>
<p>The <a class="reference external" href="https://docs.python.org/3/glossary.html#term-module" title="(in Python v3.11)"><code class="xref any docutils literal notranslate"><span class="pre">Module</span></code></a> container does not implement any of the following operations,
but the class does define the required interfaces.</p>
</section>
<section id="api">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">API</a><a class="headerlink" href="#api" title="Permalink to this heading">¶</a></h2>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
    <a id="sidebar-anchor"></a>
    

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><h3><a href="../../index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">Using DistDL</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Code Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../nn.html">distdl.nn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functional.html">distdl.functional</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backends.html">distdl.backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities.html">distdl.utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/index.html">Contributor’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/index.html#contributing">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_history/index.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Citing &amp; Acknowledgements</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/code_reference/nn/module.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
<div id="sidebarbutton" title="Collapse sidebar">
<span>«</span>
</div>

      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="norm.html" title="Normalization Layers"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="loss.html" title="Loss Functions"
             accesskey="P">previous</a> |</li>
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Microsoft.
      Last updated on May 02, 2023.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    </div>
  </body>
</html>